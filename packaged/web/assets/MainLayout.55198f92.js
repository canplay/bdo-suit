import{d as ee,Q as te}from"./decode_jwt.797f51e4.js";import{j as V,u as ae,k as oe,c as i,w as z,h,l as O,m as C,r as $,n as J,p as le,i as A,q as H,g as T,s as X,t as Y,v as Z,x as ne,y as E,z as R,a as ue,A as se,B as ie,o as re,C as N,D,E as Q,G as ce,f as g,H as I,Q as j,I as M,d as de,J as fe,K as U}from"./index.0f12b29b.js";import{u as ve,a as me,b as he,Q as ge,c as G}from"./permission.e78334f4.js";import{u as be,a as ye,Q as pe}from"./fetch.560fa2d8.js";import{Q as _,a as we}from"./QScrollObserver.5cdd1fad.js";import{u as ze}from"./vue-i18n.runtime.esm-bundler.5da13b3c.js";import"./axios.fcd5266a.js";var L=V({name:"QRouteTab",props:{...ae,...ve},emits:me,setup(e,{slots:c,emit:d}){const n=oe({useDisableForRouterLinkProps:!1}),{renderTab:t,$tabs:s}=he(e,c,d,{exact:i(()=>e.exact),...n});return z(()=>`${e.name} | ${e.exact} | ${(n.resolvedLink.value||{}).href}`,()=>{s.verifyRouteModel()}),()=>t(n.linkTag.value,n.linkAttrs.value)}}),K=V({name:"QToolbar",props:{inset:Boolean},setup(e,{slots:c}){const d=i(()=>"q-toolbar row no-wrap items-center"+(e.inset===!0?" q-toolbar--inset":""));return()=>h("div",{class:d.value,role:"toolbar"},O(c.default))}}),$e=V({name:"QHeader",props:{modelValue:{type:Boolean,default:!0},reveal:Boolean,revealOffset:{type:Number,default:250},bordered:Boolean,elevated:Boolean,heightHint:{type:[String,Number],default:50}},emits:["reveal","focusin"],setup(e,{slots:c,emit:d}){const{proxy:{$q:n}}=T(),t=A(H,C);if(t===C)return console.error("QHeader needs to be child of QLayout"),C;const s=$(parseInt(e.heightHint,10)),r=$(!0),v=i(()=>e.reveal===!0||t.view.value.indexOf("H")>-1||n.platform.is.ios&&t.isContainer.value===!0),l=i(()=>{if(e.modelValue!==!0)return 0;if(v.value===!0)return r.value===!0?s.value:0;const o=s.value-t.scroll.value.position;return o>0?o:0}),f=i(()=>e.modelValue!==!0||v.value===!0&&r.value!==!0),b=i(()=>e.modelValue===!0&&f.value===!0&&e.reveal===!0),F=i(()=>"q-header q-layout__section--marginal "+(v.value===!0?"fixed":"absolute")+"-top"+(e.bordered===!0?" q-header--bordered":"")+(f.value===!0?" q-header--hidden":"")+(e.modelValue!==!0?" q-layout--prevent-focus":"")),S=i(()=>{const o=t.rows.value.top,w={};return o[0]==="l"&&t.left.space===!0&&(w[n.lang.rtl===!0?"right":"left"]=`${t.left.size}px`),o[2]==="r"&&t.right.space===!0&&(w[n.lang.rtl===!0?"left":"right"]=`${t.right.size}px`),w});function y(o,w){t.update("header",o,w)}function x(o,w){o.value!==w&&(o.value=w)}function p({height:o}){x(s,o),y("size",o)}function k(o){b.value===!0&&x(r,!0),d("focusin",o)}z(()=>e.modelValue,o=>{y("space",o),x(r,!0),t.animate()}),z(l,o=>{y("offset",o)}),z(()=>e.reveal,o=>{o===!1&&x(r,e.modelValue)}),z(r,o=>{t.animate(),d("reveal",o)}),z(t.scroll,o=>{e.reveal===!0&&x(r,o.direction==="up"||o.position<=e.revealOffset||o.position-o.inflectionPoint<100)});const q={};return t.instances.header=q,e.modelValue===!0&&y("size",s.value),y("space",e.modelValue),y("offset",l.value),J(()=>{t.instances.header===q&&(t.instances.header=void 0,y("size",0),y("offset",0),y("space",!1))}),()=>{const o=le(c.default,[]);return e.elevated===!0&&o.push(h("div",{class:"q-layout__shadow absolute-full overflow-hidden no-pointer-events"})),o.push(h(_,{debounce:0,onResize:p})),h("header",{class:F.value,style:S.value,onFocusin:k},o)}}}),ke=V({name:"QToolbarTitle",props:{shrink:Boolean},setup(e,{slots:c}){const d=i(()=>"q-toolbar__title ellipsis"+(e.shrink===!0?" col-shrink":""));return()=>h("div",{class:d.value},O(c.default))}}),xe=V({name:"QFooter",props:{modelValue:{type:Boolean,default:!0},reveal:Boolean,bordered:Boolean,elevated:Boolean,heightHint:{type:[String,Number],default:50}},emits:["reveal","focusin"],setup(e,{slots:c,emit:d}){const{proxy:{$q:n}}=T(),t=A(H,C);if(t===C)return console.error("QFooter needs to be child of QLayout"),C;const s=$(parseInt(e.heightHint,10)),r=$(!0),v=$(X.value===!0||t.isContainer.value===!0?0:window.innerHeight),l=i(()=>e.reveal===!0||t.view.value.indexOf("F")>-1||n.platform.is.ios&&t.isContainer.value===!0),f=i(()=>t.isContainer.value===!0?t.containerHeight.value:v.value),b=i(()=>{if(e.modelValue!==!0)return 0;if(l.value===!0)return r.value===!0?s.value:0;const a=t.scroll.value.position+f.value+s.value-t.height.value;return a>0?a:0}),F=i(()=>e.modelValue!==!0||l.value===!0&&r.value!==!0),S=i(()=>e.modelValue===!0&&F.value===!0&&e.reveal===!0),y=i(()=>"q-footer q-layout__section--marginal "+(l.value===!0?"fixed":"absolute")+"-bottom"+(e.bordered===!0?" q-footer--bordered":"")+(F.value===!0?" q-footer--hidden":"")+(e.modelValue!==!0?" q-layout--prevent-focus"+(l.value!==!0?" hidden":""):"")),x=i(()=>{const a=t.rows.value.bottom,m={};return a[0]==="l"&&t.left.space===!0&&(m[n.lang.rtl===!0?"right":"left"]=`${t.left.size}px`),a[2]==="r"&&t.right.space===!0&&(m[n.lang.rtl===!0?"left":"right"]=`${t.right.size}px`),m});function p(a,m){t.update("footer",a,m)}function k(a,m){a.value!==m&&(a.value=m)}function q({height:a}){k(s,a),p("size",a)}function o(){if(e.reveal!==!0)return;const{direction:a,position:m,inflectionPoint:B}=t.scroll.value;k(r,a==="up"||m-B<100||t.height.value-f.value-m-s.value<300)}function w(a){S.value===!0&&k(r,!0),d("focusin",a)}z(()=>e.modelValue,a=>{p("space",a),k(r,!0),t.animate()}),z(b,a=>{p("offset",a)}),z(()=>e.reveal,a=>{a===!1&&k(r,e.modelValue)}),z(r,a=>{t.animate(),d("reveal",a)}),z([s,t.scroll,t.height],o),z(()=>n.screen.height,a=>{t.isContainer.value!==!0&&k(v,a)});const u={};return t.instances.footer=u,e.modelValue===!0&&p("size",s.value),p("space",e.modelValue),p("offset",b.value),J(()=>{t.instances.footer===u&&(t.instances.footer=void 0,p("size",0),p("offset",0),p("space",!1))}),()=>{const a=Y(c.default,[h(_,{debounce:0,onResize:q})]);return e.elevated===!0&&a.push(h("div",{class:"q-layout__shadow absolute-full overflow-hidden no-pointer-events"})),h("footer",{class:y.value,style:x.value,onFocusin:w},a)}}}),Ce=V({name:"QPageContainer",setup(e,{slots:c}){const{proxy:{$q:d}}=T(),n=A(H,C);if(n===C)return console.error("QPageContainer needs to be child of QLayout"),C;Z(ne,!0);const t=i(()=>{const s={};return n.header.space===!0&&(s.paddingTop=`${n.header.size}px`),n.right.space===!0&&(s[`padding${d.lang.rtl===!0?"Left":"Right"}`]=`${n.right.size}px`),n.footer.space===!0&&(s.paddingBottom=`${n.footer.size}px`),n.left.space===!0&&(s[`padding${d.lang.rtl===!0?"Right":"Left"}`]=`${n.left.size}px`),s});return()=>h("div",{class:"q-page-container",style:t.value},O(c.default))}}),Qe=V({name:"QLayout",props:{container:Boolean,view:{type:String,default:"hhh lpr fff",validator:e=>/^(h|l)h(h|r) lpr (f|l)f(f|r)$/.test(e.toLowerCase())},onScroll:Function,onScrollHeight:Function,onResize:Function},setup(e,{slots:c,emit:d}){const{proxy:{$q:n}}=T(),t=$(null),s=$(n.screen.height),r=$(e.container===!0?0:n.screen.width),v=$({position:0,direction:"down",inflectionPoint:0}),l=$(0),f=$(X.value===!0?0:E()),b=i(()=>"q-layout q-layout--"+(e.container===!0?"containerized":"standard")),F=i(()=>e.container===!1?{minHeight:n.screen.height+"px"}:null),S=i(()=>f.value!==0?{[n.lang.rtl===!0?"left":"right"]:`${f.value}px`}:null),y=i(()=>f.value!==0?{[n.lang.rtl===!0?"right":"left"]:0,[n.lang.rtl===!0?"left":"right"]:`-${f.value}px`,width:`calc(100% + ${f.value}px)`}:null);function x(u){if(e.container===!0||document.qScrollPrevented!==!0){const a={position:u.position.top,direction:u.direction,directionChanged:u.directionChanged,inflectionPoint:u.inflectionPoint.top,delta:u.delta.top};v.value=a,e.onScroll!==void 0&&d("scroll",a)}}function p(u){const{height:a,width:m}=u;let B=!1;s.value!==a&&(B=!0,s.value=a,e.onScrollHeight!==void 0&&d("scrollHeight",a),q()),r.value!==m&&(B=!0,r.value=m),B===!0&&e.onResize!==void 0&&d("resize",u)}function k({height:u}){l.value!==u&&(l.value=u,q())}function q(){if(e.container===!0){const u=s.value>l.value?E():0;f.value!==u&&(f.value=u)}}let o=null;const w={instances:{},view:i(()=>e.view),isContainer:i(()=>e.container),rootRef:t,height:s,containerHeight:l,scrollbarWidth:f,totalWidth:i(()=>r.value+f.value),rows:i(()=>{const u=e.view.toLowerCase().split(" ");return{top:u[0].split(""),middle:u[1].split(""),bottom:u[2].split("")}}),header:R({size:0,offset:0,space:!1}),right:R({size:300,offset:0,space:!1}),footer:R({size:0,offset:0,space:!1}),left:R({size:300,offset:0,space:!1}),scroll:v,animate(){o!==null?clearTimeout(o):document.body.classList.add("q-body--layout-animate"),o=setTimeout(()=>{o=null,document.body.classList.remove("q-body--layout-animate")},155)},update(u,a,m){w[u][a]=m}};if(Z(H,w),E()>0){let m=function(){u=null,a.classList.remove("hide-scrollbar")},B=function(){if(u===null){if(a.scrollHeight>n.screen.height)return;a.classList.add("hide-scrollbar")}else clearTimeout(u);u=setTimeout(m,300)},P=function(W){u!==null&&W==="remove"&&(clearTimeout(u),m()),window[`${W}EventListener`]("resize",B)},u=null;const a=document.body;z(()=>e.container!==!0?"add":"remove",P),e.container!==!0&&P("add"),ue(()=>{P("remove")})}return()=>{const u=Y(c.default,[h(we,{onScroll:x}),h(_,{onResize:p})]),a=h("div",{class:b.value,style:F.value,ref:e.container===!0?void 0:t,tabindex:-1},u);return e.container===!0?h("div",{class:"q-layout-container overflow-hidden",ref:t},[h(_,{onResize:k}),h("div",{class:"absolute-full",style:S.value},[h("div",{class:"scroll",style:y.value},[a])])]):a}}});const qe=U("div",{class:"col-auto",style:{width:"30px"}},null,-1),Be=U("div",{class:"col-auto",style:{width:"30px"}},null,-1),Ve=U("div",{class:"col-auto",style:{width:"30px"}},null,-1),Pe=se({__name:"MainLayout",setup(e){const c=ye(),d=ie(),{locale:n}=ze({useScope:"global"});n.value=navigator.language;const t=[{value:"en-US",label:"English"},{value:"zh-CN",label:"\u7B80\u4F53\u4E2D\u6587"}],s=$("index"),r=v=>{var l;(l=document.getElementById(v))==null||l.scrollIntoView()};return re(()=>{if(c.cookies.has("canplay_token")&&c.cookies.get("canplay_token")!=""){const v=ee(c.cookies.get("canplay_token")).id;be().get(d.backend+"/api/user/info/"+v,c.cookies.get("canplay_token")).then(l=>{if(l.data.status===0){if(l.data.msg==="jwt token is invalid"){c.notify("\u767B\u5F55\u8D85\u65F6, \u8BF7\u91CD\u65B0\u767B\u5F55");return}c.notify(l.data.msg);return}let f=l.data.msg.userId.split(",");d.user={userno:l.data.msg.userNo,signin:!0,username:f[0],password:f[1],familyname:l.data.msg.userNickname,cash:0,pearl:0,permission:l.data.msg.permission,characters:l.data.msg.characters}}).catch(()=>{c.notify("\u7F51\u7EDC\u9519\u8BEF\uFF0C\u8BF7\u7A0D\u540E\u91CD\u8BD5")})}}),(v,l)=>{const f=ce("router-view");return N(),D(Qe,{view:"hHh LpR fFf",style:{"background-image":"url(imgs/bg.jpg)","background-position":"right bottom, left top","background-repeat":"no-repeat, no-repeat","background-size":"100% 100%"}},{default:Q(()=>[g($e,{elevated:""},{default:Q(()=>[g(K,{class:"bg-grey-10 text-white row"},{default:Q(()=>[g(te,{class:"col-auto",src:"imgs/logo.png",width:"240px"}),qe,g(ge,{class:"col",modelValue:s.value,"onUpdate:modelValue":l[4]||(l[4]=b=>s.value=b)},{default:Q(()=>[g(L,{name:"index",label:v.$t("index"),to:"/"},null,8,["label"]),g(L,{name:"news",label:v.$t("news"),onClick:l[0]||(l[0]=b=>r("news"))},null,8,["label"]),g(L,{name:"shop",label:v.$t("shop.title"),onClick:l[1]||(l[1]=b=>r("shop"))},null,8,["label"]),g(L,{name:"downloads",label:v.$t("downloads.title"),onClick:l[2]||(l[2]=b=>r("downloads"))},null,8,["label"]),g(L,{name:"social",label:v.$t("social"),onClick:l[3]||(l[3]=b=>r("social"))},null,8,["label"])]),_:1},8,["modelValue"]),Be,I(G)().check("admin")?(N(),D(j,{key:0,flat:"",label:"\u7BA1\u7406\u9762\u677F",to:"/admin"})):M("",!0),I(G)().check("my")?(N(),D(j,{key:1,flat:"",label:"\u4E2A\u4EBA\u4FE1\u606F",to:"/my"})):M("",!0),Ve,g(pe,{dark:"",class:"col-auto",modelValue:I(n),"onUpdate:modelValue":l[5]||(l[5]=b=>de(n)?n.value=b:null),options:t,label:"Global","map-options":"","emit-value":""},null,8,["modelValue"])]),_:1})]),_:1}),g(xe,{elevated:""},{default:Q(()=>[g(K,{class:"bg-grey-10 text-white text-center"},{default:Q(()=>[g(ke,{style:{"font-size":"medium"}},{default:Q(()=>[fe(" Powered by CaNplay ")]),_:1})]),_:1})]),_:1}),g(Ce,null,{default:Q(()=>[g(f)]),_:1})]),_:1})}}});export{Pe as default};
