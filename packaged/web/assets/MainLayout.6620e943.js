import{Q as oe}from"./QImg.221eff66.js";import{j as Q,u as ae,k as le,c,w as x,h as m,l as W,m as k,r as z,n as X,p as ne,i as j,q as B,g as F,s as Y,t as Z,v as ee,x as re,y as P,z as L,a as se,A as ie,B as ue,o as ce,C as I,D as J,E as S,G as de,f as g,H as N,Q as U,I as G,d as fe,J as ve,K as A}from"./index.53ff0679.js";import{u as he,a as me,b as ge,Q as be,c as M}from"./permission.c00a529f.js";import{u as ye,a as pe,Q as we}from"./fetch.a4faf46b.js";import{Q as O,a as xe}from"./QScrollObserver.4e0a3c64.js";import{u as ze}from"./vue-i18n.runtime.esm-bundler.88d1a9f1.js";import"./axios.034f9684.js";var q=Q({name:"QRouteTab",props:{...ae,...he},emits:me,setup(e,{slots:l,emit:s}){const a=le({useDisableForRouterLinkProps:!1}),{renderTab:t,$tabs:u}=ge(e,l,s,{exact:c(()=>e.exact),...a});return x(()=>`${e.name} | ${e.exact} | ${(a.resolvedLink.value||{}).href}`,()=>{u.verifyRouteModel()}),()=>t(a.linkTag.value,a.linkAttrs.value)}}),K=Q({name:"QToolbar",props:{inset:Boolean},setup(e,{slots:l}){const s=c(()=>"q-toolbar row no-wrap items-center"+(e.inset===!0?" q-toolbar--inset":""));return()=>m("div",{class:s.value,role:"toolbar"},W(l.default))}}),Ce=Q({name:"QHeader",props:{modelValue:{type:Boolean,default:!0},reveal:Boolean,revealOffset:{type:Number,default:250},bordered:Boolean,elevated:Boolean,heightHint:{type:[String,Number],default:50}},emits:["reveal","focusin"],setup(e,{slots:l,emit:s}){const{proxy:{$q:a}}=F(),t=j(B,k);if(t===k)return console.error("QHeader needs to be child of QLayout"),k;const u=z(parseInt(e.heightHint,10)),d=z(!0),v=c(()=>e.reveal===!0||t.view.value.indexOf("H")>-1||a.platform.is.ios&&t.isContainer.value===!0),r=c(()=>{if(e.modelValue!==!0)return 0;if(v.value===!0)return d.value===!0?u.value:0;const n=u.value-t.scroll.value.position;return n>0?n:0}),f=c(()=>e.modelValue!==!0||v.value===!0&&d.value!==!0),b=c(()=>e.modelValue===!0&&f.value===!0&&e.reveal===!0),V=c(()=>"q-header q-layout__section--marginal "+(v.value===!0?"fixed":"absolute")+"-top"+(e.bordered===!0?" q-header--bordered":"")+(f.value===!0?" q-header--hidden":"")+(e.modelValue!==!0?" q-layout--prevent-focus":"")),E=c(()=>{const n=t.rows.value.top,w={};return n[0]==="l"&&t.left.space===!0&&(w[a.lang.rtl===!0?"right":"left"]=`${t.left.size}px`),n[2]==="r"&&t.right.space===!0&&(w[a.lang.rtl===!0?"left":"right"]=`${t.right.size}px`),w});function y(n,w){t.update("header",n,w)}function $(n,w){n.value!==w&&(n.value=w)}function p({height:n}){$(u,n),y("size",n)}function C(n){b.value===!0&&$(d,!0),s("focusin",n)}x(()=>e.modelValue,n=>{y("space",n),$(d,!0),t.animate()}),x(r,n=>{y("offset",n)}),x(()=>e.reveal,n=>{n===!1&&$(d,e.modelValue)}),x(d,n=>{t.animate(),s("reveal",n)}),x(t.scroll,n=>{e.reveal===!0&&$(d,n.direction==="up"||n.position<=e.revealOffset||n.position-n.inflectionPoint<100)});const T={};return t.instances.header=T,e.modelValue===!0&&y("size",u.value),y("space",e.modelValue),y("offset",r.value),X(()=>{t.instances.header===T&&(t.instances.header=void 0,y("size",0),y("offset",0),y("space",!1))}),()=>{const n=ne(l.default,[]);return e.elevated===!0&&n.push(m("div",{class:"q-layout__shadow absolute-full overflow-hidden no-pointer-events"})),n.push(m(O,{debounce:0,onResize:p})),m("header",{class:V.value,style:E.value,onFocusin:C},n)}}}),$e=Q({name:"QToolbarTitle",props:{shrink:Boolean},setup(e,{slots:l}){const s=c(()=>"q-toolbar__title ellipsis"+(e.shrink===!0?" col-shrink":""));return()=>m("div",{class:s.value},W(l.default))}}),ke=Q({name:"QFooter",props:{modelValue:{type:Boolean,default:!0},reveal:Boolean,bordered:Boolean,elevated:Boolean,heightHint:{type:[String,Number],default:50}},emits:["reveal","focusin"],setup(e,{slots:l,emit:s}){const{proxy:{$q:a}}=F(),t=j(B,k);if(t===k)return console.error("QFooter needs to be child of QLayout"),k;const u=z(parseInt(e.heightHint,10)),d=z(!0),v=z(Y.value===!0||t.isContainer.value===!0?0:window.innerHeight),r=c(()=>e.reveal===!0||t.view.value.indexOf("F")>-1||a.platform.is.ios&&t.isContainer.value===!0),f=c(()=>t.isContainer.value===!0?t.containerHeight.value:v.value),b=c(()=>{if(e.modelValue!==!0)return 0;if(r.value===!0)return d.value===!0?u.value:0;const o=t.scroll.value.position+f.value+u.value-t.height.value;return o>0?o:0}),V=c(()=>e.modelValue!==!0||r.value===!0&&d.value!==!0),E=c(()=>e.modelValue===!0&&V.value===!0&&e.reveal===!0),y=c(()=>"q-footer q-layout__section--marginal "+(r.value===!0?"fixed":"absolute")+"-bottom"+(e.bordered===!0?" q-footer--bordered":"")+(V.value===!0?" q-footer--hidden":"")+(e.modelValue!==!0?" q-layout--prevent-focus"+(r.value!==!0?" hidden":""):"")),$=c(()=>{const o=t.rows.value.bottom,h={};return o[0]==="l"&&t.left.space===!0&&(h[a.lang.rtl===!0?"right":"left"]=`${t.left.size}px`),o[2]==="r"&&t.right.space===!0&&(h[a.lang.rtl===!0?"left":"right"]=`${t.right.size}px`),h});function p(o,h){t.update("footer",o,h)}function C(o,h){o.value!==h&&(o.value=h)}function T({height:o}){C(u,o),p("size",o)}function n(){if(e.reveal!==!0)return;const{direction:o,position:h,inflectionPoint:_}=t.scroll.value;C(d,o==="up"||h-_<100||t.height.value-f.value-h-u.value<300)}function w(o){E.value===!0&&C(d,!0),s("focusin",o)}x(()=>e.modelValue,o=>{p("space",o),C(d,!0),t.animate()}),x(b,o=>{p("offset",o)}),x(()=>e.reveal,o=>{o===!1&&C(d,e.modelValue)}),x(d,o=>{t.animate(),s("reveal",o)}),x([u,t.scroll,t.height],n),x(()=>a.screen.height,o=>{t.isContainer.value!==!0&&C(v,o)});const i={};return t.instances.footer=i,e.modelValue===!0&&p("size",u.value),p("space",e.modelValue),p("offset",b.value),X(()=>{t.instances.footer===i&&(t.instances.footer=void 0,p("size",0),p("offset",0),p("space",!1))}),()=>{const o=Z(l.default,[m(O,{debounce:0,onResize:T})]);return e.elevated===!0&&o.push(m("div",{class:"q-layout__shadow absolute-full overflow-hidden no-pointer-events"})),m("footer",{class:y.value,style:$.value,onFocusin:w},o)}}}),Se=Q({name:"QPageContainer",setup(e,{slots:l}){const{proxy:{$q:s}}=F(),a=j(B,k);if(a===k)return console.error("QPageContainer needs to be child of QLayout"),k;ee(re,!0);const t=c(()=>{const u={};return a.header.space===!0&&(u.paddingTop=`${a.header.size}px`),a.right.space===!0&&(u[`padding${s.lang.rtl===!0?"Left":"Right"}`]=`${a.right.size}px`),a.footer.space===!0&&(u.paddingBottom=`${a.footer.size}px`),a.left.space===!0&&(u[`padding${s.lang.rtl===!0?"Right":"Left"}`]=`${a.left.size}px`),u});return()=>m("div",{class:"q-page-container",style:t.value},W(l.default))}}),Te=Q({name:"QLayout",props:{container:Boolean,view:{type:String,default:"hhh lpr fff",validator:e=>/^(h|l)h(h|r) lpr (f|l)f(f|r)$/.test(e.toLowerCase())},onScroll:Function,onScrollHeight:Function,onResize:Function},setup(e,{slots:l,emit:s}){const{proxy:{$q:a}}=F(),t=z(null),u=z(a.screen.height),d=z(e.container===!0?0:a.screen.width),v=z({position:0,direction:"down",inflectionPoint:0}),r=z(0),f=z(Y.value===!0?0:P()),b=c(()=>"q-layout q-layout--"+(e.container===!0?"containerized":"standard")),V=c(()=>e.container===!1?{minHeight:a.screen.height+"px"}:null),E=c(()=>f.value!==0?{[a.lang.rtl===!0?"left":"right"]:`${f.value}px`}:null),y=c(()=>f.value!==0?{[a.lang.rtl===!0?"right":"left"]:0,[a.lang.rtl===!0?"left":"right"]:`-${f.value}px`,width:`calc(100% + ${f.value}px)`}:null);function $(i){if(e.container===!0||document.qScrollPrevented!==!0){const o={position:i.position.top,direction:i.direction,directionChanged:i.directionChanged,inflectionPoint:i.inflectionPoint.top,delta:i.delta.top};v.value=o,e.onScroll!==void 0&&s("scroll",o)}}function p(i){const{height:o,width:h}=i;let _=!1;u.value!==o&&(_=!0,u.value=o,e.onScrollHeight!==void 0&&s("scrollHeight",o),T()),d.value!==h&&(_=!0,d.value=h),_===!0&&e.onResize!==void 0&&s("resize",i)}function C({height:i}){r.value!==i&&(r.value=i,T())}function T(){if(e.container===!0){const i=u.value>r.value?P():0;f.value!==i&&(f.value=i)}}let n=null;const w={instances:{},view:c(()=>e.view),isContainer:c(()=>e.container),rootRef:t,height:u,containerHeight:r,scrollbarWidth:f,totalWidth:c(()=>d.value+f.value),rows:c(()=>{const i=e.view.toLowerCase().split(" ");return{top:i[0].split(""),middle:i[1].split(""),bottom:i[2].split("")}}),header:L({size:0,offset:0,space:!1}),right:L({size:300,offset:0,space:!1}),footer:L({size:0,offset:0,space:!1}),left:L({size:300,offset:0,space:!1}),scroll:v,animate(){n!==null?clearTimeout(n):document.body.classList.add("q-body--layout-animate"),n=setTimeout(()=>{n=null,document.body.classList.remove("q-body--layout-animate")},155)},update(i,o,h){w[i][o]=h}};if(ee(B,w),P()>0){let h=function(){i=null,o.classList.remove("hide-scrollbar")},_=function(){if(i===null){if(o.scrollHeight>a.screen.height)return;o.classList.add("hide-scrollbar")}else clearTimeout(i);i=setTimeout(h,300)},H=function(D){i!==null&&D==="remove"&&(clearTimeout(i),h()),window[`${D}EventListener`]("resize",_)},i=null;const o=document.body;x(()=>e.container!==!0?"add":"remove",H),e.container!==!0&&H("add"),se(()=>{H("remove")})}return()=>{const i=Z(l.default,[m(xe,{onScroll:$}),m(O,{onResize:p})]),o=m("div",{class:b.value,style:V.value,ref:e.container===!0?void 0:t,tabindex:-1},i);return e.container===!0?m("div",{class:"q-layout-container overflow-hidden",ref:t},[m(O,{onResize:C}),m("div",{class:"absolute-full",style:E.value},[m("div",{class:"scroll",style:y.value},[o])])]):o}}});new TextEncoder;const te=new TextDecoder,_e=e=>{const l=atob(e),s=new Uint8Array(l.length);for(let a=0;a<l.length;a++)s[a]=l.charCodeAt(a);return s},Re=e=>{let l=e;l instanceof Uint8Array&&(l=te.decode(l)),l=l.replace(/-/g,"+").replace(/_/g,"/").replace(/\s/g,"");try{return _e(l)}catch{throw new TypeError("The input to be decoded is not correctly encoded.")}};class Qe extends Error{static get code(){return"ERR_JOSE_GENERIC"}constructor(l){var s;super(l),this.code="ERR_JOSE_GENERIC",this.name=this.constructor.name,(s=Error.captureStackTrace)===null||s===void 0||s.call(Error,this,this.constructor)}}class R extends Qe{constructor(){super(...arguments),this.code="ERR_JWT_INVALID"}static get code(){return"ERR_JWT_INVALID"}}function Ve(e){return typeof e=="object"&&e!==null}function Ee(e){if(!Ve(e)||Object.prototype.toString.call(e)!=="[object Object]")return!1;if(Object.getPrototypeOf(e)===null)return!0;let l=e;for(;Object.getPrototypeOf(l)!==null;)l=Object.getPrototypeOf(l);return Object.getPrototypeOf(e)===l}const qe=Re;function Le(e){if(typeof e!="string")throw new R("JWTs must use Compact JWS serialization, JWT must be a string");const{1:l,length:s}=e.split(".");if(s===5)throw new R("Only JWTs using Compact JWS serialization can be decoded");if(s!==3)throw new R("Invalid JWT");if(!l)throw new R("JWTs must contain a payload");let a;try{a=qe(l)}catch{throw new R("Failed to parse the base64url encoded payload")}let t;try{t=JSON.parse(te.decode(a))}catch{throw new R("Failed to parse the decoded payload as JSON")}if(!Ee(t))throw new R("Invalid JWT Claims Set");return t}const Oe=A("div",{class:"col-auto",style:{width:"30px"}},null,-1),Be=A("div",{class:"col-auto",style:{width:"30px"}},null,-1),Fe=A("div",{class:"col-auto",style:{width:"30px"}},null,-1),Ae=ie({__name:"MainLayout",setup(e){const l=pe(),s=ue(),{locale:a}=ze({useScope:"global"});a.value=navigator.language;const t=[{value:"en-US",label:"English"},{value:"zh-CN",label:"\u7B80\u4F53\u4E2D\u6587"}],u=z("index"),d=v=>{var r;(r=document.getElementById(v))==null||r.scrollIntoView()};return ce(()=>{if(l.cookies.has("canplay_token")&&l.cookies.get("canplay_token")!=""){const v=Le(l.cookies.get("canplay_token")).id;ye().get(s.backend+"/api/user/info/"+v,l.cookies.get("canplay_token")).then(r=>{if(r.data.status===0){l.notify(r.data.msg);return}let f=r.data.msg.userId.split(",");s.user={userno:r.data.msg.userNo,signin:!0,username:f[0],password:f[1],familyname:r.data.msg.userNickname,cash:0,pearl:0,permission:r.data.msg.permission,characters:r.data.msg.characters}}).catch(()=>{l.notify("\u7F51\u7EDC\u9519\u8BEF\uFF0C\u8BF7\u7A0D\u540E\u91CD\u8BD5")})}}),(v,r)=>{const f=de("router-view");return I(),J(Te,{view:"hHh LpR fFf",style:{"background-image":"url(imgs/bg.jpg)","background-position":"right bottom, left top","background-repeat":"no-repeat, no-repeat","background-size":"100% 100%"}},{default:S(()=>[g(Ce,{elevated:""},{default:S(()=>[g(K,{class:"bg-grey-10 text-white row"},{default:S(()=>[g(oe,{class:"col-auto",src:"imgs/logo.png",width:"240px"}),Oe,g(be,{class:"col",modelValue:u.value,"onUpdate:modelValue":r[4]||(r[4]=b=>u.value=b)},{default:S(()=>[g(q,{name:"index",label:v.$t("index"),to:"/"},null,8,["label"]),g(q,{name:"news",label:v.$t("news"),onClick:r[0]||(r[0]=b=>d("news"))},null,8,["label"]),g(q,{name:"shop",label:v.$t("shop.title"),onClick:r[1]||(r[1]=b=>d("shop"))},null,8,["label"]),g(q,{name:"downloads",label:v.$t("downloads.title"),onClick:r[2]||(r[2]=b=>d("downloads"))},null,8,["label"]),g(q,{name:"social",label:v.$t("social"),onClick:r[3]||(r[3]=b=>d("social"))},null,8,["label"])]),_:1},8,["modelValue"]),Be,N(M)().check("admin")?(I(),J(U,{key:0,flat:"",label:"\u7BA1\u7406\u9762\u677F",to:"/admin"})):G("",!0),N(M)().check("my")?(I(),J(U,{key:1,flat:"",label:"\u4E2A\u4EBA\u4FE1\u606F",to:"/my"})):G("",!0),Fe,g(we,{dark:"",class:"col-auto",modelValue:N(a),"onUpdate:modelValue":r[5]||(r[5]=b=>fe(a)?a.value=b:null),options:t,label:"Global","map-options":"","emit-value":""},null,8,["modelValue"])]),_:1})]),_:1}),g(ke,{elevated:""},{default:S(()=>[g(K,{class:"bg-grey-10 text-white text-center"},{default:S(()=>[g($e,{style:{"font-size":"medium"}},{default:S(()=>[ve(" Powered by CaNplay ")]),_:1})]),_:1})]),_:1}),g(Se,null,{default:S(()=>[g(f)]),_:1})]),_:1})}}});export{Ae as default};
